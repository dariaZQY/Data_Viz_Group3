movie<-read.csv('movie')
summary(movie)
# check if the class of Overseas and US revenue are numeric
class(movie$Overseas_rev)
class(movie$US_rev)
# find if these two variables are not, or moderate, or highly correlated
round(cor(movie$Overseas_rev, movie$US_rev, method='pearson'),digits=2)

#create scatter plot
install.packages("ggplot2")
p<-ggplot(data= movie, aes(x=movie$US_rev, y=movie$Overseas_rev))
#fix overplotting issue, draw curve instead of linear line to find the relationship between these two variables
p+geom_point(aes(x=movie$US_rev), alpha=1/5)+xlab("US Revenue")+ylab("Overseas Revenue")+
  geom_smooth(method="loess",fill='red')+
  labs(title = "Relationship Between US Revenue and Overseas Revenue", size=80)

#find good cutoff points
install.packages("data.table")

levels = c(0,100,Inf)
labels = c("negative","positive")

setDT(movie)[, grp := cut(US_rev, levels, labels)]
#cls %>%
#mutate(movie$grp=cut(movie$US_rev_num,levels,labels=labels))

q <- ggplot(data= movie, aes(x=movie$US_rev, y=movie$Overseas_rev,color=grp))
q + geom_point(aes(x=movie$US_rev), alpha=1/10) +
  xlab("US Revenue") + 
  ylab("Overseas Revenue")+
  geom_smooth(method="loess",fill=NA)+
  labs(title = "Relationship Between US Revenue and Overseas Revenue", size=80)

round(cor(movie[movie$grp=="negative"]$US_rev, movie[movie$grp=="negative"]$Overseas_rev),digits=3)
round(cor(movie[movie$grp=="positive"]$US_rev, movie[movie$grp=="positive"]$Overseas_rev),digits=3)

#Find 5 Genres with the top average US Revenue
movie_by_genre1 <- aggregate(movie$US_rev,by = list(Genre=movie$Genre), FUN = mean)
movie_by_genre1
ggplot(data = movie_by_genre1, aes(x = Genre, y =round(x) )) + geom_bar(stat = "sum",fill="lightblue") +
  theme(plot.title = element_text(hjust = 0.5))+ggtitle('Average US Revenue by Genre in $million')+ 
  xlab("Genre")+ylab("Average US Revenue")+
  geom_text(aes(label=round(x)), position=position_dodge(width=0.9), vjust=-0.25)+
  theme(axis.text.x = element_text(angle = 90, hjust = 1))
  
#Find 5 Genres with the top average Overseas Revenue
movie_by_genre2 <- aggregate(movie$Overseas_rev,by = list(Genre=movie$Genre), FUN = mean)
movie_by_genre2
ggplot(data = movie_by_genre2, aes(x = Genre, y = x)) + geom_bar(stat = "sum",fill="lightcoral") +
  theme(plot.title = element_text(hjust = 0.5))+ggtitle('Average Overseas Revenue by Genre in $million')+ 
  xlab("Genre")+ylab("Average Overseas Revenue in")+
  geom_text(aes(label=round(x)), position=position_dodge(width=0.9), vjust=-0.25)+
  theme(axis.text.x = element_text(angle = 90, hjust = 1))

#Find 10 Studios with the top average US Revenue
movie_by_studio1 <- aggregate(movie$US_rev,by = list(Studios=movie$Studio), FUN = mean)
movie_by_studio1
ggplot(data =movie_by_studio1, aes(x = Studios, y = x)) + geom_bar(stat = "sum",fill="lightgreen") +
  theme(plot.title = element_text(hjust = 0.5))+
  ggtitle('Average US Revenue by Studios in $million')+ xlab("Studios")+
  theme(axis.text.x = element_text(angle = 90, hjust = 1))+ylab("Average US Revenue")+
  geom_text(aes(label=round(x)), position=position_dodge(width=0.9), vjust=-0.25)
  
#Find 10 Studios with the top average Overseas Revenue
movie_by_studio2 <- aggregate(movie$Overseas_rev,by = list(Studios=movie$Studio), FUN = mean)
movie_by_studio2
ggplot(data =movie_by_studio2, aes(x = Studios, y = x)) + geom_bar(stat = "sum",fill="khaki1") +
  theme(plot.title = element_text(hjust = 0.5))+
  ggtitle('Average Oversea Revenue by Studios in $million')+ xlab("Studios")+
  theme(axis.text.x = element_text(angle = 90, hjust = 1))+ylab("Average US Revenue in $million")+
  geom_text(aes(label=round(x)), position=position_dodge(width=0.9), vjust=-0.25)

